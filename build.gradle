apply from: file("${rootDir}/gradle/project.gradle")
def repo = System.getProperty("user.home")

def mvplabVersion = '4.0.0'
def guavaVersion = '31.0.1-jre'
def jacksonVersion = '2.13.0'
def jerseyVersion = "3.0.3"
def jedisVersion = '3.7.0'
def commonPoolVersion = '2.11.1'
def commonDBCPVersion = '2.9.0'
def hibernateVersion = '6.0.0.Beta1'
def hibernateValidatorVersion = '7.0.0.Final'
def asmVersion = '9.2'
def javassistVersion = '3.28.0-GA'
def undertowVersion = '2.2.12.Final'

subprojects {
    repositories {
        maven { url 'https://maven.aliyun.com/nexus/content/groups/public/' }
        mavenCentral()

        mavenLocal()
        flatDir {
            dirs "${rootDir}/module/captcha-web-simple/libs"
        }
    }

    if (!childProjects.isEmpty()) return    // ignore parent project
    apply plugin: 'maven-publish'
    publishing {
        publications {
            mavenJava(MavenPublication) {
                from components.java
            }
        }

        repositories {
            maven {
                url "${repo}/Workspace/maven-repo"
            }
        }
    }

    group = 'app'
    version = "${mvplabVersion}"
}


project(':framework:module') {
    apply from: file("${rootDir}/gradle/module.gradle")

    dependencies {
        api("com.google.guava:guava:${guavaVersion}") {
            exclude group: 'com.google.code.findbugs'
        }

        api 'org.glassfish.hk2.external:aopalliance-repackaged:3.0.2'
        api 'org.slf4j:slf4j-api:1.7.30'
        api group: 'jakarta.inject', name: 'jakarta.inject-api', version: '2.0.1'
        api group: 'jakarta.annotation', name: 'jakarta.annotation-api', version: '2.0.0'

        api group: 'jakarta.validation', name: 'jakarta.validation-api', version: '3.0.0'
        api 'jakarta.ws.rs:jakarta.ws.rs-api:3.0.0'
        api group: 'jakarta.activation', name: 'jakarta.activation-api', version: '2.0.1'
        api group: 'jakarta.xml.bind', name: 'jakarta.xml.bind-api', version: '2.3.3'
        api "com.fasterxml.jackson.module:jackson-module-jaxb-annotations:${jacksonVersion}"
        api "com.fasterxml.jackson.datatype:jackson-datatype-jsr310:${jacksonVersion}"
        api "com.fasterxml.jackson.datatype:jackson-datatype-jdk8:${jacksonVersion}"
        api "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:${jacksonVersion}"
        api group: 'org.slf4j', name: 'jul-to-slf4j', version: '1.7.30'

        implementation "org.javassist:javassist:${javassistVersion}"
        implementation group: 'org.ow2.asm', name: 'asm', version: "${asmVersion}"

        implementation(group: 'org.hibernate.validator', name: 'hibernate-validator', version: "${hibernateValidatorVersion}") {
            exclude group: 'org.jboss.logging'
        }

        testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: '5.2.0'
        testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:5.2.0"
        testImplementation 'org.mockito:mockito-core:2.17.0'
        testImplementation 'org.hsqldb:hsqldb:2.4.0'
    }
}


project(':framework:app') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api('org.glassfish.hk2:hk2-api:3.0.1') {
        }
        implementation group: 'org.jboss.logging', name: 'jboss-logging', version: '3.3.2.Final'
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-common', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.media', name: 'jersey-media-json-jackson', version: "${jerseyVersion}") {
            exclude group: 'com.fasterxml.jackson.core'
            exclude group: 'com.fasterxml.jackson.module'
            exclude group: 'javax.xml.bind'
        }
        implementation(group: 'org.glassfish.jersey.media', name: 'jersey-media-sse', version: "${jerseyVersion}") {
            exclude group: 'com.fasterxml.jackson.core'
            exclude group: 'com.fasterxml.jackson.module'
            exclude group: 'javax.xml.bind'
        }
        implementation(group: 'org.glassfish.jersey.ext', name: 'jersey-bean-validation', version: "${jerseyVersion}") {
            exclude group: 'org.hibernate'
        }
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
        }
        testImplementation project(':framework:test')
    }
}


project(':framework:logback') {
    apply from: file("${rootDir}/gradle/module.gradle")

    dependencies {
        api project(':framework:module')
        implementation group: 'ch.qos.logback', name: 'logback-classic', version: '1.2.3'
    }
}

project(':framework:service') {
    apply from: file("${rootDir}/gradle/module.gradle")

    dependencies {
        api project(':framework:module')
        implementation "com.fasterxml.jackson.module:jackson-module-jaxb-annotations:${jacksonVersion}"
        implementation "com.fasterxml.jackson.datatype:jackson-datatype-jsr310:${jacksonVersion}"
        implementation "com.fasterxml.jackson.datatype:jackson-datatype-jdk8:${jacksonVersion}"
        implementation "com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:${jacksonVersion}"
        implementation "org.javassist:javassist:${javassistVersion}"
        implementation "org.glassfish.jersey.ext:jersey-proxy-client:${jerseyVersion}"
        implementation(group: 'org.glassfish.jersey.ext', name: 'jersey-bean-validation', version: "${jerseyVersion}") {
            exclude group: 'org.hibernate'
            exclude group: 'javax.el'
            exclude group: 'org.glassfish.web', module: 'javax.el'
        }
        implementation(group: 'org.glassfish.jersey.media', name: 'jersey-media-json-jackson', version: "${jerseyVersion}") {
            exclude group: 'com.fasterxml.jackson.core'
            exclude group: 'com.fasterxml.jackson.module'
            exclude group: 'org.glassfish.hk2.external'
            exclude group: 'javax.xml.bind'
        }
        testImplementation project(':framework:test')
        testImplementation project(':framework:undertow')
    }
}

project(':framework:admin') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:web')
        testImplementation project(':framework:test')
    }
}

project(':framework:cache-redis') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:cache')
        implementation "redis.clients:jedis:${jedisVersion}"
        implementation "org.apache.commons:commons-pool2:${commonPoolVersion}"
        testImplementation project(':framework:test')
    }
}

project(':framework:cache') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        testImplementation project(':framework:test')
    }
}

project(':framework:scheduler') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        implementation(group: 'org.quartz-scheduler', name: 'quartz', version: '2.3.0') {
            exclude group: 'com.mchange'
            exclude group: 'com.zaxxer'
        }
        testImplementation project(':framework:test')
    }
}

project(':framework:message') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        testImplementation project(':framework:test')
    }
}

project(':framework:message-rabbitmq') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:message')
        implementation group: 'org.apache.commons', name: 'commons-pool2', version: "${commonPoolVersion}"
        implementation group: 'com.rabbitmq', name: 'amqp-client', version: '5.4.1'
        testImplementation project(':framework:test')
    }
}

project(':framework:message-redis') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:message')
        implementation group: 'org.apache.commons', name: 'commons-pool2', version: "${commonPoolVersion}"
        implementation "redis.clients:jedis:${jedisVersion}"
        testImplementation project(':framework:test')
    }
}

project(':framework:database') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api group: 'jakarta.persistence', name: 'jakarta.persistence-api', version: '3.0.0'
        api group: 'jakarta.transaction', name: 'jakarta.transaction-api', version: '2.0.0'
        implementation "org.apache.commons:commons-dbcp2:${commonDBCPVersion}"
        implementation(group: 'org.hibernate', name: 'hibernate-core', version: "${hibernateVersion}") {
            exclude group: 'org.jboss.spec.javax.transaction'
            exclude group: 'org.jboss.logging'
            exclude group: 'javax.xml.bind'
        }
        testImplementation project(':framework:test')
    }
}

project(':framework:undertow') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:message')
        api project(':framework:app')
        api('org.glassfish.hk2:hk2-api:2.5.0-b42') {
            exclude group: 'javax.inject'
        }

        implementation group: 'org.jboss.logging', name: 'jboss-logging', version: '3.3.2.Final'
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
            exclude group: 'javax.validation'
        }
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-common', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: "${jerseyVersion}") {
            exclude group: 'javax.inject'
        }
        implementation(group: 'org.glassfish.jersey.media', name: 'jersey-media-json-jackson', version: "${jerseyVersion}") {
            exclude group: 'com.fasterxml.jackson.core'
            exclude group: 'com.fasterxml.jackson.module'
            exclude group: 'javax.xml.bind'
        }
        implementation(group: 'org.glassfish.jersey.ext', name: 'jersey-bean-validation', version: "${jerseyVersion}") {
            exclude group: 'org.hibernate'
            exclude group: 'javax.el'
            exclude group: 'org.glassfish.web', module: 'javax.el'
        }
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
            exclude group: 'javax.validation'
        }
        implementation("io.undertow:undertow-core:${undertowVersion}") {
            exclude group: 'org.jboss.logging'
        }
        testImplementation project(':framework:test')
    }
}

project(':framework:template') {
    apply from: file("${rootDir}/gradle/module.gradle")

    dependencies {
        api project(':framework:module')
        implementation group: 'org.apache.commons', name: 'commons-jexl3', version: '3.1'
        implementation 'net.htmlparser.jericho:jericho-html:3.4'
        implementation "org.javassist:javassist:${javassistVersion}"
        testImplementation project(':framework:test')
    }
}

project(':framework:web') {
    apply from: file("${rootDir}/gradle/module.gradle")

    dependencies {
        api project(':framework:module')
        api project(':framework:template')
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-common', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.hibernate.validator', name: 'hibernate-validator', version: "${hibernateValidatorVersion}") {
            exclude group: 'org.jboss.logging'
        }
        implementation "redis.clients:jedis:${jedisVersion}"
        implementation 'org.apache.commons:commons-pool2:${commonPoolVersion}'
        testImplementation project(':framework:test')
    }
}

project(':framework:test') {
    apply from: file("${rootDir}/gradle/module.gradle")


    dependencies {
        api project(':framework:module')
        api project(':framework:app')
        api group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: '5.2.0'
        api 'org.mockito:mockito-core:2.17.0'
        api(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
        }
        implementation 'org.hsqldb:hsqldb:2.4.0'
        implementation project(':framework:database')
        implementation project(':framework:logback')
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-common', version: "${jerseyVersion}") {
        }
        implementation group: 'org.jboss.logging', name: 'jboss-logging', version: '3.3.2.Final'
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-common', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.inject', name: 'jersey-hk2', version: "${jerseyVersion}") {
        }
        implementation(group: 'org.glassfish.jersey.media', name: 'jersey-media-json-jackson', version: "${jerseyVersion}") {
            exclude group: 'com.fasterxml.jackson.core'
            exclude group: 'com.fasterxml.jackson.module'
            exclude group: 'javax.xml.bind'
        }
        implementation(group: 'org.glassfish.jersey.ext', name: 'jersey-bean-validation', version: "${jerseyVersion}") {
            exclude group: 'org.hibernate'
            exclude group: 'org.glassfish.web', module: 'javax.el'
        }
        implementation(group: 'org.glassfish.jersey.core', name: 'jersey-server', version: "${jerseyVersion}") {
        }
        implementation "org.junit.jupiter:junit-jupiter-engine:5.2.0"

        testImplementation project(':framework:web')
        testImplementation project(':framework:service')
    }
}

project(':main') {
    apply from: file("${rootDir}/gradle/app.gradle")

    dependencies {
        implementation group: 'jakarta.activation', name: 'jakarta.activation-api', version: '2.0.1'
        implementation project(':framework:undertow')
        implementation project(':framework:app')
        implementation project(':framework:logback')
        implementation project(':framework:web')
        implementation project(':framework:database')
        implementation project(':framework:admin')
        implementation group: 'ch.qos.logback', name: 'logback-classic', version: '1.2.3'
        implementation 'mysql:mysql-connector-java:8.0.11'
        implementation group: 'org.liquibase', name: 'liquibase-core', version: '3.6.2'
        implementation 'org.hsqldb:hsqldb:2.4.0'
        implementation "org.apache.commons:commons-dbcp2:${commonDBCPVersion}"
        implementation 'com.fasterxml.jackson.core:jackson-databind:2.9.8'
    }
}

project(':codegen') {
    apply from: file("${rootDir}/gradle/app.gradle")

    dependencies {
        implementation group: 'jakarta.activation', name: 'jakarta.activation-api', version: '2.0.1'
        implementation "com.google.guava:guava:${guavaVersion}"
        implementation 'com.github.javaparser:javaparser-symbol-solver-core:3.13.0'
        implementation 'org.apache.velocity:velocity:1.7'

        testImplementation project(':framework:database')

        testImplementation group: 'jakarta.transaction', name: 'jakarta.transaction-api', version: '2.0.0'
        testImplementation group: 'jakarta.persistence', name: 'jakarta.persistence-api', version: '3.0.0'

        testImplementation group: 'org.junit.jupiter', name: 'junit-jupiter-api', version: '5.2.0'
        testImplementation group: 'jakarta.xml.bind', name: 'jakarta.xml.bind-api', version: '2.3.3'
        testImplementation group: 'jakarta.inject', name: 'jakarta.inject-api', version: '2.0.1'
        testImplementation group: 'jakarta.annotation', name: 'jakarta.annotation-api', version: '2.0.0'
        testImplementation group: 'jakarta.validation', name: 'jakarta.validation-api', version: '3.0.0'
        testImplementation 'jakarta.ws.rs:jakarta.ws.rs-api:3.0.0'

        testImplementation project(':framework:test')
    }
}
